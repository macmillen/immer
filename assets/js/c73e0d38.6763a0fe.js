"use strict";(self.webpackChunkimmer_website=self.webpackChunkimmer_website||[]).push([[247],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>b});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(n),d=o,b=p["".concat(s,".").concat(d)]||p[d]||u[d]||a;return n?r.createElement(b,i(i({ref:t},m),{},{components:n})):r.createElement(b,i({ref:t},m))}));function b(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5896:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var r=n(3117),o=n(102),a=(n(7294),n(3905)),i=["components"],l={id:"complex-objects",title:"Classes"},s=void 0,c={unversionedId:"complex-objects",id:"complex-objects",title:"Classes",description:"By default, Immer does not strictly handle Plain object's non-eumerable properties such as getters/setters for performance reason. If you want this behavior to be strict, you can opt-in with useStrictShallowCopy(true).",source:"@site/docs/complex-objects.md",sourceDirName:".",slug:"/complex-objects",permalink:"/immer/complex-objects",draft:!1,editUrl:"https://github.com/immerjs/immer/edit/main/website/docs/complex-objects.md",tags:[],version:"current",frontMatter:{id:"complex-objects",title:"Classes"},sidebar:"Immer",previous:{title:"Map and Set",permalink:"/immer/map-set"},next:{title:"Current",permalink:"/immer/current"}},m={},p=[{value:"Example",id:"example",level:3},{value:"Semantics in detail",id:"semantics-in-detail",level:3}],u={toc:p};function d(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("center",null,(0,a.kt)("div",{"data-ea-publisher":"immerjs","data-ea-type":"image",className:"horizontal bordered"})),(0,a.kt)("p",null,"By default, Immer does not strictly handle Plain object's non-eumerable properties such as getters/setters for performance reason. If you want this behavior to be strict, you can opt-in with ",(0,a.kt)("inlineCode",{parentName:"p"},"useStrictShallowCopy(true)"),"."),(0,a.kt)("p",null,"Plain objects (objects without a prototype), arrays, ",(0,a.kt)("inlineCode",{parentName:"p"},"Map"),"s and ",(0,a.kt)("inlineCode",{parentName:"p"},"Set"),"s are always drafted by Immer. Every other object must use the ",(0,a.kt)("inlineCode",{parentName:"p"},"immerable")," symbol to mark itself as compatible with Immer. When one of these objects is mutated within a producer, its prototype is preserved between copies."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'import {immerable} from "immer"\n\nclass Foo {\n    [immerable] = true // Option 1\n\n    constructor() {\n        this[immerable] = true // Option 2\n    }\n}\n\nFoo[immerable] = true // Option 3\n')),(0,a.kt)("h3",{id:"example"},"Example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'import {immerable, produce} from "immer"\n\nclass Clock {\n    [immerable] = true\n\n    constructor(hour, minute) {\n        this.hour = hour\n        this.minute = minute\n    }\n\n    get time() {\n        return `${this.hour}:${this.minute}`\n    }\n\n    tick() {\n        return produce(this, draft => {\n            draft.minute++\n        })\n    }\n}\n\nconst clock1 = new Clock(12, 10)\nconst clock2 = clock1.tick()\nconsole.log(clock1.time) // 12:10\nconsole.log(clock2.time) // 12:11\nconsole.log(clock2 instanceof Clock) // true\n')),(0,a.kt)("h3",{id:"semantics-in-detail"},"Semantics in detail"),(0,a.kt)("p",null,"The semantics on how classes are drafted are as follows:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"A draft of a class is a fresh object but with the same prototype as the original object."),(0,a.kt)("li",{parentName:"ol"},"When creating a draft, Immer will copy all ",(0,a.kt)("em",{parentName:"li"},"own")," properties from the base to the draft.This includes non-enumerable and symbolic properties."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("em",{parentName:"li"},"Own")," getters will be invoked during the copy process, just like ",(0,a.kt)("inlineCode",{parentName:"li"},"Object.assign")," would."),(0,a.kt)("li",{parentName:"ol"},"Inherited getters and methods will remain as is and be inherited by the draft."),(0,a.kt)("li",{parentName:"ol"},"Immer will not invoke constructor functions."),(0,a.kt)("li",{parentName:"ol"},"The final instance will be constructed with the same mechanism as the draft was created."),(0,a.kt)("li",{parentName:"ol"},"Only getters that have a setter as well will be writable in the draft, as otherwise the value can't be copied back.")),(0,a.kt)("p",null,"Because Immer will dereference own getters of objects into normal properties, it is possible to use objects that use getter/setter traps on their fields, like MobX and Vue do."),(0,a.kt)("p",null,"Immer does not support exotic / engine native objects such as DOM Nodes or Buffers, nor is subclassing Map, Set or arrays supported and the ",(0,a.kt)("inlineCode",{parentName:"p"},"immerable")," symbol can't be used on them."),(0,a.kt)("p",null,"So when working for example with ",(0,a.kt)("inlineCode",{parentName:"p"},"Date")," objects, you should always create a new ",(0,a.kt)("inlineCode",{parentName:"p"},"Date")," instance instead of mutating an existing ",(0,a.kt)("inlineCode",{parentName:"p"},"Date")," object."))}d.isMDXComponent=!0}}]);